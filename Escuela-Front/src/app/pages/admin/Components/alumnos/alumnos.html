<div class="container-fluid py-4">
  <div class="row">
    <div class="col-12">
      <div class="header-section">
        <h2 class="text-uppercase titulo-h2">ALUMNOS</h2>
        <h5 class="titulo-h5">Gestión de Alumnos Registrados</h5>
      </div>
    </div>
  </div>

<div class="container">

  <!-- Filtro de Asignación -->
  <div class="filter-section">
    <div class="row align-items-end">
      <div class="col-md-9 mb-3">
        <label class="form-label fw-bold">Grado, Grupo y Ciclo: <span class="text-danger">*</span></label>
        <select 
          class="form-select" 
          [(ngModel)]="asignacionSeleccionada" 
          (change)="onAsignacionChange()">
          <option *ngFor="let asignacion of asignaciones" [value]="asignacion.id">
            {{ asignacion.value }}
          </option>
        </select>
      </div>

      <div class="col-md-3 mb-3 d-flex gap-2">
        <!-- <button class="btn btn--clear" (click)="limpiarFiltros()">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
            <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/>
            <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"/>
          </svg>
          Limpiar
        </button> -->
        <button class="btn btn--new" (click)="nuevo()">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
            <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/>
            <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4"/>
          </svg>
          Nuevo
        </button>
      </div>
    </div>
  </div>

  <!-- Mensaje cuando no hay alumnos -->
  <div *ngIf="registrosGGC.length === 0" class="no-data">
    <p>No hay alumnos registrados para esta asignación.</p>
  </div>

<!-- Tabla -->
<div class="table-card" *ngIf="registrosGGC.length > 0">
  <div class="table-responsive">
    <table class="data-table">
      <thead>
        <tr>
          <th>MATRÍCULA</th>
          <th>NOMBRE COMPLETO</th>
          <th>CURP</th>
          <th>GRADO</th>
          <th>GRUPO</th>
          <th>TUTOR</th>
          <th>ESTATUS</th>
          <th>ACCIONES</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let alumno of registrosGGC; let i = index" [class.row-alt]="i % 2 !== 0">
          <td>{{ alumno.matricula }}</td>
          <td>{{ alumno.nombre }} {{ alumno.apellidoPaterno }} {{ alumno.apellidoMaterno }}</td>
          <td>{{ alumno.curp }}</td>
          <td>{{ alumno.gradoNombre }}</td>
          <td>{{ alumno.grupoNombre }}</td>
          
          <td>
            <div *ngIf="alumno.tieneTutor && alumno.tutorNombreCompleto" class="tutor-info">
              <div class="tutor-nombre">
                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 16 16">
                  <path d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6m2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0m4 8c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4m-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.289 10 8 10s-3.516.68-4.168 1.332c-.678.678-.83 1.418-.832 1.664z"/>
                </svg>
                {{ alumno.tutorNombreCompleto }}
              </div>
              <div *ngIf="alumno.tutorTelefono" class="tutor-telefono">
                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 16 16">
                  <path d="M3.654 1.328a.678.678 0 0 0-1.015-.063L1.605 2.3c-.483.484-.661 1.169-.45 1.77a17.6 17.6 0 0 0 4.168 6.608 17.6 17.6 0 0 0 6.608 4.168c.601.211 1.286.033 1.77-.45l1.034-1.034a.678.678 0 0 0-.063-1.015l-2.307-1.794a.68.68 0 0 0-.58-.122l-2.19.547a1.75 1.75 0 0 1-1.657-.459L5.482 8.062a1.75 1.75 0 0 1-.46-1.657l.548-2.19a.68.68 0 0 0-.122-.58z"/>
                </svg>
                {{ alumno.tutorTelefono }}
              </div>
            </div>
            <span *ngIf="!alumno.tieneTutor" class="sin-tutor">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 16 16">
                <path d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6m2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0m4 8c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4m-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.289 10 8 10s-3.516.68-4.168 1.332c-.678.678-.83 1.418-.832 1.664z"/>
              </svg>
              Sin tutor
            </span>
          </td>
          
          <!-- Switch de estatus -->
          <td>
            <div class="status-toggle">
              <span class="status-label-small">Inactivo</span>
              <label class="toggle">
                <input 
                  type="checkbox" 
                  [checked]="alumno.estatus === 'ACTIVO'"
                  (click)="cambiarEstatus(alumno, $event)"
                  [id]="'switch-' + alumno.alumnoId">
                <span class="toggle__slider"></span>
              </label>
              <span class="status-label-small">Activo</span>
            </div>
          </td>
          
          <!-- Botones de acciones -->
          <td>
            <div class="actions-group">
              <button class="btn-icon-edit" (click)="EditarS(alumno.alumnoId)" title="Editar">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                  <path d="M12.146.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1 0 .708l-10 10a.5.5 0 0 1-.168.105l-5.313 1.77a.5.5 0 0 1-.606-.606l1.77-5.313a.5.5 0 0 1 .105-.168l10-10zM11.207 2.5 13.5 4.793 14.793 3.5 12.5 1.207zm1.586 3L10.5 3.207 4 9.707V10h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.293l6.5-6.5zm-9.761 5.175-.106.106-1.528 3.821 3.821-1.528.106-.106A.5.5 0 0 1 5 12.5v-.5a.5.5 0 0 1 .5-.5h.5a.5.5 0 0 1 .5-.5v-.5a.5.5 0 0 1 .176-.358z"/>
                </svg>
              </button>
              
              <button class="btn-icon-view" (click)="irPerfil(alumno.alumnoId)" title="Ver Perfil">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                  <path d="M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8M1.173 8a13 13 0 0 1 1.66-2.043C4.12 4.668 5.88 3.5 8 3.5s3.879 1.168 5.168 2.457A13 13 0 0 1 14.828 8q-.086.13-.195.288c-.335.48-.83 1.12-1.465 1.755C11.879 11.332 10.119 12.5 8 12.5s-3.879-1.168-5.168-2.457A13 13 0 0 1 1.172 8z"/>
                  <path d="M8 5.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5M4.5 8a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0"/>
                </svg>
              </button>

              <button 
                *ngIf="!alumno.tieneTutor"
                class="btn-icon-tutor" 
                (click)="asignarTutor(alumno.alumnoId, alumno.nombre + ' ' + alumno.apellidoPaterno + ' ' + alumno.apellidoMaterno)" 
                title="Asignar Tutor">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                  <path d="M7 14s-1 0-1-1 1-4 5-4 5 3 5 4-1 1-1 1zm4-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6m-5.784 6A2.24 2.24 0 0 1 5 13c0-1.355.68-2.75 1.936-3.72A6.3 6.3 0 0 0 5 9c-4 0-5 3-5 4s1 1 1 1zM4.5 8a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5"/>
                </svg>
              </button>

              <button 
                *ngIf="alumno.esUltimaInscripcion"
                class="btn-icon-assignment" 
                (click)="actualizarAsignacion(alumno.alumnoId, alumno.nombre + ' ' + alumno.apellidoPaterno + ' ' + alumno.apellidoMaterno)" 
                title="Actualizar Asignación">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                  <path d="M12.146.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1 0 .708l-10 10a.5.5 0 0 1-.168.11l-5 2a.5.5 0 0 1-.65-.65l2-5a.5.5 0 0 1 .11-.168l10-10zM11.207 2.5 13.5 4.793 14.793 3.5 12.5 1.207zm1.586 3L10.5 3.207 4 9.707V10h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.293zM9.5 5.5 11 7l-6.5 6.5-.106.106-1.528 3.821 3.821-1.528.106-.106L13.5 9 12 7.5l-2.5 2.5z"/>
                  <path fill-rule="evenodd" d="M7 14s-1 0-1-1 1-4 5-4 5 3 5 4-1 1-1 1zm4-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6"/>
                </svg>
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Paginación -->
  <div class="pagination-container" *ngIf="totalPaginas > 1">
    <nav>
      <ul class="pagination justify-content-center">
        <li class="page-item" [class.disabled]="paginaActual === 1">
          <button class="page-link" (click)="cambiarPagina(paginaActual - 1)">‹</button>
        </li>
        <li class="page-item" *ngFor="let p of totalPaginasArray" [class.active]="p === paginaActual">
          <button class="page-link" (click)="cambiarPagina(p)">{{ p }}</button>
        </li>
        <li class="page-item" [class.disabled]="paginaActual === totalPaginas">
          <button class="page-link" (click)="cambiarPagina(paginaActual + 1)">›</button>
        </li>
      </ul>
    </nav>
  </div>
</div>

<!-- Modales -->
<app-nuevo-alumno 
  *ngIf="nuevom" 
  [nuevo]="nuevom" 
  (cerrar)="cerrarModal($event)">
</app-nuevo-alumno>

<app-editar-alumno 
  *ngIf="editarm"
  [editar]="editarm"
  [alumno]="idAl"
  (cerrar)="cerrarModalEditar($event)">
</app-editar-alumno>

<app-asignar-tutor
  *ngIf="asignarTutorm"
  [mostrar]="asignarTutorm"
  [alumnoId]="alumnoIdParaTutor"
  [nombreAlumno]="nombreAlumnoParaTutor"
  (cerrar)="cerrarModalAsignarTutor($event)">
</app-asignar-tutor>

<app-perfil-estudiante
  *ngIf="verEstudiante"
  [verEstudiante]="verEstudiante"
  [idAlumno]="idAlumnoSeleccionado"
  (cerrar)="cerrarModalPerfil($event)">
</app-perfil-estudiante>

<app-actualizar-asignacion
  *ngIf="actualizarAsignacionm"
  [mostrar]="actualizarAsignacionm"
  [alumnoId]="alumnoIdParaAsignacion"
  [nombreAlumno]="nombreAlumnoParaAsignacion"
  [asignacionActualId]="asignacionActualId"
  [inscripcionId]="inscripcionIdParaAsignacion"
  (cerrar)="cerrarModalActualizarAsignacion($event)">
</app-actualizar-asignacion>

<app-loading></app-loading>