<div class="container-fluid py-4">
  <div class="row">
    <div class="col-12">
      <h2 class="text-uppercase mb-1 titulo-h2">Registro de Calificaciones</h2>
      <h5 class="text-muted mb-4 titulo-h5">Gestión detallada de las evaluaciones por estudiante y periodo académico.
      </h5>
    </div>
  </div>

  <div class="card p-4 mb-5 shadow-lg form-card-padding">
    <div class="row g-4">

      <div class="col-md-4 col-sm-6">
        <label for="materia" class="form-label required-label">Materia:</label>
        <select id="materia" class="form-select" [(ngModel)]="formulario.materia">
          <option value="" disabled selected>Seleccione una materia</option>
        </select>
      </div>
      <div class="col-md-4 col-sm-6">
        <label for="estudiante" class="form-label required-label">Estudiante:</label>
        <input type="text" id="estudiante" class="form-control" [(ngModel)]="formulario.estudiante"
          placeholder="Ingrese nombre o matrícula">
      </div>
      <div class="col-md-4 col-sm-6">
        <label for="trimestre" class="form-label required-label">Trimestre:</label>
        <select id="trimestre" class="form-select" [(ngModel)]="formulario.trimestre">
          <option value="" disabled selected>Seleccione el trimestre</option>
        </select>
      </div>
      <div class="col-md-4 col-sm-6">
        <label for="calificacion" class="form-label required-label">Calificación:</label>
        <input type="number" id="calificacion" class="form-control" [(ngModel)]="formulario.calificacion" min="0"
          max="10" placeholder="0 - 10">
      </div>

      <div class="col-12 d-flex justify-content-end align-items-end pt-md-4 pt-sm-3">
        <button type="button" class="btn btn-action btn-guardar me-3" (click)="guardar()">Guardar</button>
        <button type="button" class="btn btn-action btn-limpiar" (click)="limpiar()">Limpiar</button>
      </div>
    </div>
  </div>

  <div class="card p-4 shadow-lg table-grid-card">

    <div class="table-responsive">
      <table class="table table-striped table-hover grid-table align-middle">
        <thead class="grid-header text-whit">
          <tr>
            <th class="col-th">MATRICULA</th>
            <th class="col-th">NOMBRE ESTUDIANTE</th>
            <th class="col-th">MATERIA</th>
            <th class="col-th">GRADO</th>
            <th class="col-th">GRUPO</th>
            <th class="col-th">TRIMESTRE</th>
            <th class="col-th">CICLO</th>
            <th class="col-th">CALIFICACIÓN</th>
            <th class="col-th">ACCIÓN</th>
          </tr>
          <tr class="filter-row">
            <td><input type="text" class="form-control form-control-sm" [(ngModel)]="filtros.matricula"
                (ngModelChange)="aplicarFiltros()" placeholder="Buscar..." /></td>
            <td><input type="text" class="form-control form-control-sm" [(ngModel)]="filtros.nombreEstudiante"
                (ngModelChange)="aplicarFiltros()" placeholder="Buscar..." /></td>
            <td><input type="text" class="form-control form-control-sm" [(ngModel)]="filtros.materia"
                (ngModelChange)="aplicarFiltros()" placeholder="Buscar..." /></td>
            <td><input type="text" class="form-control form-control-sm" [(ngModel)]="filtros.grado"
                (ngModelChange)="aplicarFiltros()" placeholder="Buscar..." /></td>
            <td><input type="text" class="form-control form-control-sm" [(ngModel)]="filtros.grupo"
                (ngModelChange)="aplicarFiltros()" placeholder="Buscar..." /></td>
            <td><input type="text" class="form-control form-control-sm" [(ngModel)]="filtros.trimestre"
                (ngModelChange)="aplicarFiltros()" placeholder="Buscar..." /></td>
            <td><input type="text" class="form-control form-control-sm" [(ngModel)]="filtros.ciclo"
                (ngModelChange)="aplicarFiltros()" placeholder="Buscar..." /></td>
            <td><input type="text" class="form-control form-control-sm" [(ngModel)]="filtros.calificacion"
                (ngModelChange)="aplicarFiltros()" placeholder="Buscar..." /></td>
            <td></td>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let registro of registrosPaginados">
            <td>{{ registro.matricula }}</td>
            <td>{{ registro.nombreEstudiante }}</td>
            <td>{{ registro.materia }}</td>
            <td>{{ registro.grado }}</td>
            <td>{{ registro.grupo }}</td>
            <td>{{ registro.trimestre }}</td>
            <td>{{ registro.ciclo }}</td>
            <td class="fw-bold">{{ registro.calificacion }}</td>
            <td>
              <button class="btn btn-icon-circular" (click)="editar(registro)" title="Editar">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pencil"
                  viewBox="0 0 16 16">
                  <path
                    d="M12.146.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1 0 .708l-10 10a.5.5 0 0 1-.168.105l-5.313 1.77a.5.5 0 0 1-.606-.606l1.77-5.313a.5.5 0 0 1 .105-.168l10-10zM11.207 2.5 13.5 4.793 14.793 3.5 12.5 1.207zm1.586 3L10.5 3.207 4 9.707V10h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.293l6.5-6.5zm-9.761 5.175-.106.106-1.528 3.821 3.821-1.528.106-.106A.5.5 0 0 1 5 12.5v-.5a.5.5 0 0 1 .5-.5h.5a.5.5 0 0 1 .5-.5v-.5a.5.5 0 0 1 .176-.358z" />
                </svg>
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="d-flex justify-content-center mt-4">
      <nav aria-label="Paginación de registros">
        <ul class="pagination pagination-standard shadow-sm">
          <li class="page-item" [class.disabled]="paginaActual === 1">
            <a class="page-link" href="#" (click)="irAPagina(paginaActual - 1)" aria-label="Anterior">
              <span aria-hidden="true">&laquo;</span>
            </a>
          </li>

          <li class="page-item" *ngFor="let num of [].constructor(totalPaginas); let i = index"
            [class.active]="paginaActual === i + 1">
            <a class="page-link" href="#" (click)="irAPagina(i + 1)">{{ i + 1 }}</a>
          </li>

          <li class="page-item" [class.disabled]="paginaActual === totalPaginas">
            <a class="page-link" href="#" (click)="irAPagina(paginaActual + 1)" aria-label="Siguiente">
              <span aria-hidden="true">&raquo;</span>
            </a>
          </li>
        </ul>
      </nav>
    </div>
  </div>

  <app-modal-edicion-calificacion [registro]="registroParaEditar" (cerrar)="cerrarModal($event)">
  </app-modal-edicion-calificacion>
</div>